# Image overview:

Hello and welcome to my image, this is the first image that I have published and as such, will most likely not be suitable for enterprise solutions, but should be suitable for any home user.  There are many alternatives to this image that accomplish the same task, mine is designed to be as simple as possible, so that it can be set up easily and forgotten about while it accomplishes it's task.  The script currently runs every 5 minutes, set in stone, it's possible in future updates that this will be changed to make a custom interval possible.

# Who is this image for?

This image is for any home lab hobbyist to be able to set up their own DDNS with as little hassle as possible.  I have tried to minimize the amount of things you will need to get started, please see section ‘Things that you will need’ below for further details.

# What problem does this image solve?

This image is designed to update the IP record of your domain's external IP on your Cloudflare DNS account through the CloudFlare API.  This is designed for a user who wishes to set up their own website/ other services that they would like to expose to the internet.  One of the problems that some users, including myself, experience is that whenever their router is reset, there's a chance that the external IP of their network will change!  This is not ideal as the usual way to update the IP of your network on CloudFlare is manually, meaning that you would have to notice that the IP had changed to begin with, possibly by a rude text message from one of your website's users, then log in to your CloudFlare account and update the DNS A record so that it matches your current external IP, this would unfortunately mean that none of your service's users could access your services in the meantime.  This image basically monitors your network's external IP and then automatically updates CloudFlare whenever there is a change, so that you can sit back, relax and confidently avoid any further rude messages, at least for this issue.

# How to use this image

As mentioned previously, this image is designed to be as simple as possible, what follows will be a list of things that you will need before you are able to run this image successfully, along with some optional useful tips.

## Things that you will need:

### A domain

This will be the only expense that will be required with this project, there are many domain providers to choose from but do check that you can switch your the DNS from the current provider to CloudFlare before purchasing.  For simplicity, understand that a domain purchased through CloudFlare would come with the required DNS pre-packaged.  [Here](https://developers.cloudflare.com/dns/zone-setups/full-setup/setup/) is CloudFlare's guide to switching DNS providers to them in any case.

### A machine with Docker and optionally Docker Compose available

I tend to use the [Installation Script](https://github.com/docker/docker-install) for Linux machines, Docker Compose will have to be installed [seperately](https://docs.docker.com/compose/install/linux/), instructions for Windows machines can be found [here](https://docs.docker.com/compose/install/), note that Docker Compose is included in the Docker Desktop Windows installation.

### The name of your domain

This is simply the text string that you want to navigate to to reach your website or service (e.g. example.com), write it in a text document.

### The Zone ID of your Domain

This is the unique identifier for your DNS Zone, follow instructions [here](https://developers.cloudflare.com/fundamentals/setup/find-account-and-zone-ids/) to find it, then label and add it to the text document.

### A DNS A record for your domain name

You will need to create your DNS record for your domain manually, instructions can be found [here](https://developers.cloudflare.com/dns/manage-dns-records/how-to/create-dns-records/), below are the required settings, your current external IP can be found [here](http://checkip.amazonaws.com/).  Note: The image is not designed to create a DNS record that it then updates, so if this is not set up correctly, the container is likely to function correctly.  The most important part is that it is an A record and that your_domain_name matches your domain name:

![Alt text](https://i.ibb.co/Gt2kFK0/A-Record-Example.png)

### A CloudFlare API PUT key

This will have to be generated by yourself for your account, remember that any API key is very sensitive and shouldn't be shared with anyone, lest the person will be able to do anything that this API key allows them to do.  Instructions to navigate to the Create Custom API token page can be found [here](https://developers.cloudflare.com/fundamentals/api/get-started/create-token/) and the specific settings for the PUT key are shown below:

![Alt text](https://i.ibb.co/K7cchWb/PUT-example.png)

The next page will contain a string of characters that represents your API key, write this down in your text file and label it as the PUT Key.

### A CloudFlare API GET key

Follow the same instructions as in the previous section, but this time use the below settings for the GET key:

![Alt text](https://i.ibb.co/pjZpB48/GET-example.png)

Write this down in your text document and label it as the API GET key, I believe that the API PUT key includes read capabilities so this may be removed in the future.

# Bringing it all together

Now that you have all the information needed to get this image running in a container, we will bring it all together.  In this section you will find the docker run command and Docker Compose file to run this image in a container on your own server!  I would recommend that you put your sensitive information like API keys into an .env file and change the permissions so that only administrators can read it, each way is highlighted in this section.

## Setup Instructions

I will go through these instructions on Linux but Windows will be similar:

Step 1: Browse to a sensible location and create a new folder to house the project:


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
mkdir cloudflare-ddns-updater && cd cloudflare-ddns-updater
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


Step 2: Copy the Docker Compose of your choosing in the below section and save it to a file named ‘cloudflare-ddns-updater.yml’


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
nano cloudflare-ddns-updater.yml
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


Step 3 (optional): Create the .env file, paste the template in the next section into it, fill out with your values and save:


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
touch .env && sudo chown root:root .env && sudo chmod 600 .env && sudo nano .env
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


This file will be restricted so that only root can open and edit it, so remember to sudo before trying to open it.

The project structure should look as below at this point:

![Alt text](https://i.ibb.co/7YR1L4H/project-structure.png)

Step 4: Bring the container up with:


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
sudo docker compose -f cloudflare-ddns-updater.yml up -d
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


or by running the no .env docker run command in the command examples below.

Step 5: The script is set to execute every 5 minutes, so check the logs with the below command to see how it goes:


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
docker logs cloudflare-ddns-updater
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


And check that the container is running correctly with this command:


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
docker container ls
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


# Docker command and compose examples

## No .env file:

### Docker run


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
docker run -d \
  --name cloudflare-ddns-updater \
  --init \
  --restart always \
  --log-opt max-size=10m \
  --log-opt max-file=3 \
  -e DNS_RECORD_NAME=your_zone_name \
  -e PUT_KEY=your_put_key \
  -e GET_KEY=your_get_key \
  -e DNS_ZONE_ID=your_zone_id \
  -itd mathat13/cloudflare-ddns-updater:latest
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


### Docker Compose


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
services:
  cloudflare-ddns-updater:
    image: mathat13/cloudflare-ddns-updater:latest
    container_name: cloudflare-ddns-updater
    init: true
    restart: always
    logging:
      options:
        max-size: "10m"
        max-file: "3"
    environment:
      - DNS_RECORD_NAME=your_zone_name
      - PUT_KEY=your_put_key
      - GET_KEY=your_get_key
      - DNS_ZONE_ID=your_zone_id
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


## With .env file:

### Docker run:


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
docker run -d \
  --name cloudflare-ddns-updater \
  --init \
  --restart always \
  --log-opt max-size=10m \
  --log-opt max-file=3 \
  --env-file .env \
  -itd mathat13/cloudflare-ddns-updater:latest
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


### Docker Compose:


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
services:
  cloudflare-ddns-updater:
    image: mathat13/cloudflare-ddns-updater:latest
    container_name: cloudflare-ddns-updater
    init: true
    restart: always
    env_file:
      - .env
    logging:
      options:
        max-size: "10m"
        max-file: "3"
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


### .env file:


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
DNS_RECORD_NAME=your_record_name
PUT_KEY=your_put_key
GET_KEY=your_get_key
DNS_ZONE_ID=your_zone_id
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
